(function(){"use strict";var r,S=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&S.decode();var h=null;function m(){return(h===null||h.byteLength===0)&&(h=new Uint8Array(r.memory.buffer)),h}function M(e,n){return e=e>>>0,S.decode(m().subarray(e,e+n))}var b=new Array(128).fill(void 0);b.push(void 0,null,!0,!1);var F=b.length;function U(e){F===b.length&&b.push(b.length+1);const n=F;return F=b[n],b[n]=e,n}function C(e){return b[e]}function R(e){e<132||(b[e]=F,F=e)}function T(e){const n=C(e);return R(e),n}var s=0;function j(e,n){const t=n(e.length*1)>>>0;return m().set(e,t/1),s=e.length,t}var k=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},I=typeof k.encodeInto=="function"?function(e,n){return k.encodeInto(e,n)}:function(e,n){const t=k.encode(e);return n.set(t),{read:e.length,written:t.length}};function y(e,n,t){if(t===void 0){const c=k.encode(e),d=n(c.length)>>>0;return m().subarray(d,d+c.length).set(c),s=c.length,d}let a=e.length,i=n(a)>>>0;const l=m();let o=0;for(;o<a;o++){const c=e.charCodeAt(o);if(c>127)break;l[i+o]=c}if(o!==a){o!==0&&(e=e.slice(o)),i=t(i,a,a=o+e.length*3)>>>0;const c=m().subarray(i+o,i+a);o+=I(e,c).written}return s=o,i}function f(e){return e==null}var A=null;function v(){return(A===null||A.byteLength===0)&&(A=new Int32Array(r.memory.buffer)),A}function D(e,n){return e=e>>>0,m().subarray(e/1,e/1+n)}var E=null;function $(){return(E===null||E.byteLength===0)&&(E=new Uint32Array(r.memory.buffer)),E}function q(e,n){e=e>>>0;const a=$().subarray(e/4,e/4+n),i=[];for(let l=0;l<a.length;l++)i.push(T(a[l]));return i}function B(e,n,t,a,i){var l=f(e)?0:y(e,r.__wbindgen_malloc,r.__wbindgen_realloc),o=s,c=f(n)?0:y(n,r.__wbindgen_malloc,r.__wbindgen_realloc),d=s,w=f(t)?0:y(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=s,p=f(a)?0:y(a,r.__wbindgen_malloc,r.__wbindgen_realloc),g=s,u=f(i)?0:y(i,r.__wbindgen_malloc,r.__wbindgen_realloc),L=s;const K=r.createConverter(l,o,c,d,w,_,p,g,u,L);return x.__wrap(K)}var x=class{static __wrap(e){e=e>>>0;const n=Object.create(x.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_converter_free(e)}registerFont(e){const n=j(e,r.__wbindgen_malloc),t=s;r.converter_registerFont(this.__wbg_ptr,n,t)}convert(e,n,t,a,i){try{const g=r.__wbindgen_add_to_stack_pointer(-16),u=y(e,r.__wbindgen_malloc,r.__wbindgen_realloc),L=s;var l=f(i)?0:y(i,r.__wbindgen_malloc,r.__wbindgen_realloc),o=s;r.converter_convert(g,this.__wbg_ptr,u,L,!f(n),f(n)?0:n,!f(t),f(t)?0:t,!f(a),f(a)?0:a,l,o);var c=v()[g/4+0],d=v()[g/4+1],w=v()[g/4+2],_=v()[g/4+3];if(_)throw T(w);var p=D(c,d).slice();return r.__wbindgen_free(c,d*1),p}finally{r.__wbindgen_add_to_stack_pointer(16)}}list_fonts(){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.converter_list_fonts(a,this.__wbg_ptr);var e=v()[a/4+0],n=v()[a/4+1],t=q(e,n).slice();return r.__wbindgen_free(e,n*4),t}finally{r.__wbindgen_add_to_stack_pointer(16)}}};async function N(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(a){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",a);else throw a}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function V(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(n,t){const a=M(n,t);return U(a)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const n=new Error;return U(n)},e.wbg.__wbg_stack_658279fe44541cf6=function(n,t){const a=C(t).stack,i=y(a,r.__wbindgen_malloc,r.__wbindgen_realloc),l=s;v()[n/4+1]=l,v()[n/4+0]=i},e.wbg.__wbg_error_f851667af71bcfc6=function(n,t){let a,i;try{a=n,i=t,console.error(M(n,t))}finally{r.__wbindgen_free(a,i)}},e.wbg.__wbindgen_object_drop_ref=function(n){T(n)},e.wbg.__wbindgen_throw=function(n,t){throw new Error(M(n,t))},e}function H(e,n){return r=e.exports,O.__wbindgen_wasm_module=n,A=null,E=null,h=null,r.__wbindgen_start(),r}async function O(e){if(r!==void 0)return r;typeof e=="undefined"&&(e=new URL("svg2png_wasm_bg.wasm",void 0));const n=V();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:a}=await N(await e,n);return H(t,a)}var J=O,W=!1,P=async e=>{if(W)throw new Error("Already initialized. The `initialize` function can be used only once.");await J(await e),W=!0},G=e=>{var a,i,l,o,c,d;if(!W)throw new Error("WASM has not been initialized. Call `initialize` function.");let n;n=B((a=e==null?void 0:e.defaultFontFamily)==null?void 0:a.serifFamily,(i=e==null?void 0:e.defaultFontFamily)==null?void 0:i.sansSerifFamily,(l=e==null?void 0:e.defaultFontFamily)==null?void 0:l.cursiveFamily,(o=e==null?void 0:e.defaultFontFamily)==null?void 0:o.fantasyFamily,(c=e==null?void 0:e.defaultFontFamily)==null?void 0:c.monospaceFamily);for(const w of(d=e==null?void 0:e.fonts)!=null?d:[])n.registerFont(w);const t=(w,_)=>new Promise((p,g)=>{try{const u=n==null?void 0:n.convert(w,_==null?void 0:_.scale,_==null?void 0:_.width,_==null?void 0:_.height,_==null?void 0:_.backgroundColor);if(u)p(u);else throw new Error("Converter already disposed.")}catch(u){u instanceof Error?g(u):g(new Error(`${u}`))}});return t.dispose=()=>{n==null||n.free(),n=void 0},t.getLoadedFontFamilies=()=>{var w;return(w=n==null?void 0:n.list_fonts())!=null?w:[]},t};console.log("worker initializing");let z;self.addEventListener("message",e=>{const n=e.data;if(!(typeof n!="object"||n==null))switch(console.log(`worker ${n.type}`),n.type){case"initialize":P("/svg2png-wasm/svg2png.wasm").then(()=>{z=G(n.options)});break;case"svg2png":z===void 0?self.postMessage({type:"error",error:"svg2png has not been initialized."}):z(n.svg,n.options).then(t=>self.postMessage({id:n.id,type:"success",data:t})).catch(t=>self.postMessage({id:n.id,type:"error",error:`${t}`}));break}})})();
