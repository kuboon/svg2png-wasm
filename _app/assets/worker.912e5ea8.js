(function(){"use strict";var r,L=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});L.decode();var A;function v(){return A.byteLength===0&&(A=new Uint8Array(r.memory.buffer)),A}function W(e,n){return L.decode(v().subarray(e,e+n))}var b=new Array(32).fill(void 0);b.push(void 0,null,!0,!1);var h=b.length;function S(e){h===b.length&&b.push(b.length+1);const n=h;return h=b[n],b[n]=e,n}function C(e){return b[e]}function R(e){e<36||(b[e]=h,h=e)}function E(e){const n=C(e);return R(e),n}var _=0;function j(e,n){const t=n(e.length*1);return v().set(e,t/1),_=e.length,t}var p=new TextEncoder("utf-8"),x=typeof p.encodeInto=="function"?function(e,n){return p.encodeInto(e,n)}:function(e,n){const t=p.encode(e);return n.set(t),{read:e.length,written:t.length}};function y(e,n,t){if(t===void 0){const c=p.encode(e),w=n(c.length);return v().subarray(w,w+c.length).set(c),_=c.length,w}let a=e.length,i=n(a);const l=v();let o=0;for(;o<a;o++){const c=e.charCodeAt(o);if(c>127)break;l[i+o]=c}if(o!==a){o!==0&&(e=e.slice(o)),i=t(i,a,a=o+e.length*3);const c=v().subarray(i+o,i+a);o+=x(e,c).written}return _=o,i}function f(e){return e==null}var k;function m(){return k.byteLength===0&&(k=new Int32Array(r.memory.buffer)),k}function $(e,n){return v().subarray(e/1,e/1+n)}var M;function q(){return M.byteLength===0&&(M=new Uint32Array(r.memory.buffer)),M}function B(e,n){const a=q().subarray(e/4,e/4+n),i=[];for(let l=0;l<a.length;l++)i.push(E(a[l]));return i}function D(e,n,t,a,i){var l=f(e)?0:y(e,r.__wbindgen_malloc,r.__wbindgen_realloc),o=_,c=f(n)?0:y(n,r.__wbindgen_malloc,r.__wbindgen_realloc),w=_,d=f(t)?0:y(t,r.__wbindgen_malloc,r.__wbindgen_realloc),s=_,F=f(a)?0:y(a,r.__wbindgen_malloc,r.__wbindgen_realloc),g=_,u=f(i)?0:y(i,r.__wbindgen_malloc,r.__wbindgen_realloc),I=_;const K=r.createConverter(l,o,c,w,d,s,F,g,u,I);return T.__wrap(K)}var T=class{static __wrap(e){const n=Object.create(T.prototype);return n.ptr=e,n}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();r.__wbg_converter_free(e)}registerFont(e){const n=j(e,r.__wbindgen_malloc),t=_;r.converter_registerFont(this.ptr,n,t)}convert(e,n,t,a,i){try{const g=r.__wbindgen_add_to_stack_pointer(-16),u=y(e,r.__wbindgen_malloc,r.__wbindgen_realloc),I=_;var l=f(i)?0:y(i,r.__wbindgen_malloc,r.__wbindgen_realloc),o=_;r.converter_convert(g,this.ptr,u,I,!f(n),f(n)?0:n,!f(t),f(t)?0:t,!f(a),f(a)?0:a,l,o);var c=m()[g/4+0],w=m()[g/4+1],d=m()[g/4+2],s=m()[g/4+3];if(s)throw E(d);var F=$(c,w).slice();return r.__wbindgen_free(c,w*1),F}finally{r.__wbindgen_add_to_stack_pointer(16)}}list_fonts(){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.converter_list_fonts(a,this.ptr);var e=m()[a/4+0],n=m()[a/4+1],t=B(e,n).slice();return r.__wbindgen_free(e,n*4),t}finally{r.__wbindgen_add_to_stack_pointer(16)}}};async function N(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(a){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",a);else throw a}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function V(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(n,t){const a=W(n,t);return S(a)},e.wbg.__wbg_new_693216e109162396=function(){const n=new Error;return S(n)},e.wbg.__wbg_stack_0ddaca5d1abfb52f=function(n,t){const a=C(t).stack,i=y(a,r.__wbindgen_malloc,r.__wbindgen_realloc),l=_;m()[n/4+1]=l,m()[n/4+0]=i},e.wbg.__wbg_error_09919627ac0992f5=function(n,t){try{console.error(W(n,t))}finally{r.__wbindgen_free(n,t)}},e.wbg.__wbindgen_object_drop_ref=function(n){E(n)},e.wbg.__wbindgen_throw=function(n,t){throw new Error(W(n,t))},e}function H(e,n){return r=e.exports,O.__wbindgen_wasm_module=n,k=new Int32Array(r.memory.buffer),M=new Uint32Array(r.memory.buffer),A=new Uint8Array(r.memory.buffer),r.__wbindgen_start(),r}async function O(e){typeof e=="undefined"&&(e=new URL("svg2png_wasm_bg.wasm",void 0));const n=V();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:a}=await N(await e,n);return H(t,a)}var J=O,U=!1,P=async e=>{if(U)throw new Error("Already initialized. The `initialize` function can be used only once.");await J(await e),U=!0},G=e=>{var a,i,l,o,c,w;if(!U)throw new Error("WASM has not been initialized. Call `initialize` function.");let n;n=D((a=e==null?void 0:e.defaultFontFamily)==null?void 0:a.serifFamily,(i=e==null?void 0:e.defaultFontFamily)==null?void 0:i.sansSerifFamily,(l=e==null?void 0:e.defaultFontFamily)==null?void 0:l.cursiveFamily,(o=e==null?void 0:e.defaultFontFamily)==null?void 0:o.fantasyFamily,(c=e==null?void 0:e.defaultFontFamily)==null?void 0:c.monospaceFamily);for(const d of(w=e==null?void 0:e.fonts)!=null?w:[])n.registerFont(d);const t=(d,s)=>new Promise((F,g)=>{try{const u=n==null?void 0:n.convert(d,s==null?void 0:s.scale,s==null?void 0:s.width,s==null?void 0:s.height,s==null?void 0:s.backgroundColor);if(u)F(u);else throw new Error("Converter already disposed.")}catch(u){u instanceof Error?g(u):g(new Error(`${u}`))}});return t.dispose=()=>{n==null||n.free(),n=void 0},t.getLoadedFontFamilies=()=>{var d;return(d=n==null?void 0:n.list_fonts())!=null?d:[]},t};console.log("worker initializing");let z;self.addEventListener("message",e=>{const n=e.data;if(!(typeof n!="object"||n==null))switch(console.log(`worker ${n.type}`),n.type){case"initialize":P("/svg2png-wasm/svg2png.wasm").then(()=>{z=G(n.options)});break;case"svg2png":z===void 0?self.postMessage({type:"error",error:"svg2png has not been initialized."}):z(n.svg,n.options).then(t=>self.postMessage({id:n.id,type:"success",data:t})).catch(t=>self.postMessage({id:n.id,type:"error",error:`${t}`}));break}})})();
