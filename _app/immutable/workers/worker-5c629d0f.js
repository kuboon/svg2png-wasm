(function(){"use strict";var r,L=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&L.decode();var m=null;function y(){return(m===null||m.byteLength===0)&&(m=new Uint8Array(r.memory.buffer)),m}function k(e,n){return e=e>>>0,L.decode(y().subarray(e,e+n))}var w=new Array(128).fill(void 0);w.push(void 0,null,!0,!1);var h=w.length;function R(e){h===w.length&&w.push(w.length+1);const n=h;return h=w[n],w[n]=e,n}function S(e){return w[e]}function j(e){e<132||(w[e]=h,h=e)}function M(e){const n=S(e);return j(e),n}var d=0;function I(e,n){const t=n(e.length*1,1)>>>0;return y().set(e,t/1),d=e.length,t}var p=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},D=typeof p.encodeInto=="function"?function(e,n){return p.encodeInto(e,n)}:function(e,n){const t=p.encode(e);return n.set(t),{read:e.length,written:t.length}};function u(e,n,t){if(t===void 0){const c=p.encode(e),l=n(c.length,1)>>>0;return y().subarray(l,l+c.length).set(c),d=c.length,l}let i=e.length,a=n(i,1)>>>0;const s=y();let o=0;for(;o<i;o++){const c=e.charCodeAt(o);if(c>127)break;s[a+o]=c}if(o!==i){o!==0&&(e=e.slice(o)),a=t(a,i,i=o+e.length*3,1)>>>0;const c=y().subarray(a+o,a+i),l=D(e,c);o+=l.written,a=t(a,i,o,1)>>>0}return d=o,a}function g(e){return e==null}var F=null;function b(){return(F===null||F.byteLength===0)&&(F=new Int32Array(r.memory.buffer)),F}function $(e,n){return e=e>>>0,y().subarray(e/1,e/1+n)}var A=null;function q(){return(A===null||A.byteLength===0)&&(A=new Uint32Array(r.memory.buffer)),A}function B(e,n){e=e>>>0;const i=q().subarray(e/4,e/4+n),a=[];for(let s=0;s<i.length;s++)a.push(M(i[s]));return a}function N(e,n,t,i,a){var s=g(e)?0:u(e,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d,c=g(n)?0:u(n,r.__wbindgen_malloc,r.__wbindgen_realloc),l=d,_=g(t)?0:u(t,r.__wbindgen_malloc,r.__wbindgen_realloc),E=d,v=g(i)?0:u(i,r.__wbindgen_malloc,r.__wbindgen_realloc),f=d,z=g(a)?0:u(a,r.__wbindgen_malloc,r.__wbindgen_realloc),C=d;const Q=r.createConverter(s,o,c,l,_,E,v,f,z,C);return x.__wrap(Q)}var U=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_converter_free(e>>>0)),x=class{static __wrap(e){e=e>>>0;const n=Object.create(x.prototype);return n.__wbg_ptr=e,U.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,U.unregister(this),e}free(){const e=this.__destroy_into_raw();r.__wbg_converter_free(e)}registerFont(e){const n=I(e,r.__wbindgen_malloc),t=d;r.converter_registerFont(this.__wbg_ptr,n,t)}convert(e,n,t,i,a){try{const f=r.__wbindgen_add_to_stack_pointer(-16),z=u(e,r.__wbindgen_malloc,r.__wbindgen_realloc),C=d;var s=g(a)?0:u(a,r.__wbindgen_malloc,r.__wbindgen_realloc),o=d;r.converter_convert(f,this.__wbg_ptr,z,C,!g(n),g(n)?0:n,!g(t),g(t)?0:t,!g(i),g(i)?0:i,s,o);var c=b()[f/4+0],l=b()[f/4+1],_=b()[f/4+2],E=b()[f/4+3];if(E)throw M(_);var v=$(c,l).slice();return r.__wbindgen_free(c,l*1,1),v}finally{r.__wbindgen_add_to_stack_pointer(16)}}list_fonts(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.converter_list_fonts(i,this.__wbg_ptr);var e=b()[i/4+0],n=b()[i/4+1],t=B(e,n).slice();return r.__wbindgen_free(e,n*4,4),t}finally{r.__wbindgen_add_to_stack_pointer(16)}}};async function V(e,n){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,n)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,n)}else{const t=await WebAssembly.instantiate(e,n);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}function H(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(n,t){const i=k(n,t);return R(i)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const n=new Error;return R(n)},e.wbg.__wbg_stack_658279fe44541cf6=function(n,t){const i=S(t).stack,a=u(i,r.__wbindgen_malloc,r.__wbindgen_realloc),s=d;b()[n/4+1]=s,b()[n/4+0]=a},e.wbg.__wbg_error_f851667af71bcfc6=function(n,t){let i,a;try{i=n,a=t,console.error(k(n,t))}finally{r.__wbindgen_free(i,a,1)}},e.wbg.__wbindgen_object_drop_ref=function(n){M(n)},e.wbg.__wbindgen_throw=function(n,t){throw new Error(k(n,t))},e}function J(e,n){return r=e.exports,O.__wbindgen_wasm_module=n,F=null,A=null,m=null,r.__wbindgen_start(),r}async function O(e){if(r!==void 0)return r;typeof e>"u"&&(e=new URL("svg2png_wasm_bg.wasm",void 0));const n=H();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:i}=await V(await e,n);return J(t,i)}var P=O,T=!1,G=async e=>{if(T)throw new Error("Already initialized. The `initialize` function can be used only once.");await P(await e),T=!0},K=e=>{var i,a,s,o,c;if(!T)throw new Error("WASM has not been initialized. Call `initialize` function.");let n;n=N((i=e==null?void 0:e.defaultFontFamily)==null?void 0:i.serifFamily,(a=e==null?void 0:e.defaultFontFamily)==null?void 0:a.sansSerifFamily,(s=e==null?void 0:e.defaultFontFamily)==null?void 0:s.cursiveFamily,(o=e==null?void 0:e.defaultFontFamily)==null?void 0:o.fantasyFamily,(c=e==null?void 0:e.defaultFontFamily)==null?void 0:c.monospaceFamily);for(const l of(e==null?void 0:e.fonts)??[])n.registerFont(l);const t=(l,_)=>new Promise((E,v)=>{try{const f=n==null?void 0:n.convert(l,_==null?void 0:_.scale,_==null?void 0:_.width,_==null?void 0:_.height,_==null?void 0:_.backgroundColor);if(f)E(f);else throw new Error("Converter already disposed.")}catch(f){f instanceof Error?v(f):v(new Error(`${f}`))}});return t.dispose=()=>{n==null||n.free(),n=void 0},t.getLoadedFontFamilies=()=>(n==null?void 0:n.list_fonts())??[],t};console.log("worker initializing");let W;self.addEventListener("message",e=>{const n=e.data;if(!(typeof n!="object"||n==null))switch(console.log(`worker ${n.type}`),n.type){case"initialize":G(n.wasm).then(()=>{W=K(n.options)});break;case"svg2png":W===void 0?self.postMessage({type:"error",error:"svg2png has not been initialized."}):W(n.svg,n.options).then(t=>self.postMessage({id:n.id,type:"success",data:t})).catch(t=>self.postMessage({id:n.id,type:"error",error:`${t}`}));break}})})();
